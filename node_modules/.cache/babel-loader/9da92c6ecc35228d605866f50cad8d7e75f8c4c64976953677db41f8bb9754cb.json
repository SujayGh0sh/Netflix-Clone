{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sujayghosh/Documents/netflix/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sujayghosh/Documents/netflix/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/sujayghosh/Documents/netflix/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{loadStripe}from\"@stripe/stripe-js\";import React,{useEffect,useState}from\"react\";import{useSelector}from\"react-redux\";import{selectUser}from\"../features/userSlice\";import db from\"../firebase\";import\"./PlanScreen.css\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function PlanScreen(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];var user=useSelector(selectUser);var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),subscription=_useState4[0],setSubscription=_useState4[1];useEffect(function(){db.collection(\"customers\").doc(user.uid).collection(\"subscriptions\").get().then(function(querySnapshort){querySnapshort.forEach(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(subscription){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setSubscription({role:subscription.data().role,current_period_end:subscription.data().current_period_end.seconds,current_period_start:subscription.data().current_period_start.seconds});case 1:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());});},[user.uid]);useEffect(function(){db.collection(\"products\").where(\"active\",\"==\",true).get().then(function(querySnapshort){var products={};querySnapshort.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(productDoc){var priceSnap;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:products[productDoc.id]=productDoc.data();_context2.next=3;return productDoc.ref.collection(\"prices\").get();case 3:priceSnap=_context2.sent;priceSnap.docs.forEach(function(price){products[productDoc.id].prices={priceId:price.id,priceData:price.data()};});case 5:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());setProducts(products);});},[]);console.log(products);if(subscription&&subscription.role)if(subscription&&subscription.current_period_end)console.log(\"ads\",subscription,subscription.role);var loadCheckout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(priceId){var docRef;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.next=2;return db.collection(\"customers\").doc(user.uid).collection(\"checkout_sessions\").add({price:priceId,success_url:window.location.origin,cancel_url:window.location.origin});case 2:docRef=_context4.sent;docRef.onSnapshot(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(snap){var _snap$data,error,sessionId,stripe;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_snap$data=snap.data(),error=_snap$data.error,sessionId=_snap$data.sessionId;if(error){alert(\"An error occurred: \".concat(error.message));}if(!sessionId){_context3.next=7;break;}_context3.next=5;return loadStripe(\"pk_test_51MVcA6SCUViwXHI98bsZZ6SAApob7bE88hnBKjXFNM4Xh510P0D4WMNYgEvdpfcO4vMivKZnkMokYeewDMzahKz500voXiuD0n\");case 5:stripe=_context3.sent;stripe.redirectToCheckout({sessionId:sessionId});case 7:case\"end\":return _context3.stop();}},_callee3);}));return function(_x4){return _ref4.apply(this,arguments);};}());case 4:case\"end\":return _context4.stop();}},_callee4);}));return function loadCheckout(_x3){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"planScreen\",children:[subscription&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Renewal date:\",\" \",new Date((subscription===null||subscription===void 0?void 0:subscription.current_period_end)*1000).toLocaleDateString()]}),Object.entries(products).map(function(_ref5){var _productData$name;var _ref6=_slicedToArray(_ref5,2),productsId=_ref6[0],productData=_ref6[1];var isCurrentPlan=null;if(subscription&&subscription.role)isCurrentPlan=(_productData$name=productData.name)===null||_productData$name===void 0?void 0:_productData$name.includes(subscription.role);// console.log(\"saAS\", isCurrentPlan);\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(isCurrentPlan&&\"planScreen_plan--disabled\",\" planScreen_plan\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"planScreen_info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:productData.name}),/*#__PURE__*/_jsx(\"h6\",{children:productData.description})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return!isCurrentPlan&&loadCheckout(productData.prices.priceId);},children:isCurrentPlan?\"Current Plan\":\"Subscribe\"})]},productsId);})]});// return(\n//   <div className=\"planScreen\">\n//     {subscription && (\n//       <p>\n//         Renewal date:{\" \"}\n//         {new Date(subscription?.current_period_end * 1000).toLocaleDateString}\n//       </p>\n//     )}\n//     {Object.entries(products).map(([productId, productData]) => {\n//       const isCurrentPackage = productData.name?.toLowerCase().includes(subscription?.role);\n//       return(\n//         <div key={productId} className={`${isCurrentPackage && \"planScreen_plan--disabled\"} planScreen_plan`}>\n//           <div className=\"planScreen_info\">\n//             <h5>{productData.name}</h5>\n//             <h6>{productData.description}</h6>\n//           </div>\n//           <button onClick={() => !isCurrentPackage && loadCheckout(productData.prices.priceId)}>\n//             {isCurrentPackage ? \"Current Package\" : \"Subscribe\"}\n//           </button>\n//         </div>\n//       );\n//     })}\n//   </div>\n// );\n}export default PlanScreen;","map":{"version":3,"names":["loadStripe","React","useEffect","useState","useSelector","selectUser","db","PlanScreen","products","setProducts","user","subscription","setSubscription","collection","doc","uid","get","then","querySnapshort","forEach","role","data","current_period_end","seconds","current_period_start","where","productDoc","id","ref","priceSnap","docs","price","prices","priceId","priceData","console","log","loadCheckout","add","success_url","window","location","origin","cancel_url","docRef","onSnapshot","snap","error","sessionId","alert","message","stripe","redirectToCheckout","Date","toLocaleDateString","Object","entries","map","productsId","productData","isCurrentPlan","name","includes","description"],"sources":["/Users/sujayghosh/Documents/netflix/src/Screens/PlanScreen.js"],"sourcesContent":["import { loadStripe } from \"@stripe/stripe-js\";\nimport React, { useEffect, useState } from \"react\";\n\nimport { useSelector } from \"react-redux\";\nimport { selectUser } from \"../features/userSlice\";\nimport db from \"../firebase\";\nimport \"./PlanScreen.css\";\n\nfunction PlanScreen() {\n  const [products, setProducts] = useState([]);\n  const user = useSelector(selectUser);\n  const [subscription, setSubscription] = useState(null);\n\n  useEffect(() => {\n    db.collection(\"customers\")\n      .doc(user.uid)\n      .collection(\"subscriptions\")\n      .get()\n      .then((querySnapshort) => {\n        querySnapshort.forEach(async (subscription) => {\n          setSubscription({\n            role: subscription.data().role,\n            current_period_end: subscription.data().current_period_end.seconds,\n            current_period_start:\n              subscription.data().current_period_start.seconds,\n          });\n        });\n      });\n  }, [user.uid]);\n\n  useEffect(() => {\n    db.collection(\"products\") \n      .where(\"active\", \"==\", true)\n      .get()\n      .then((querySnapshort) => {\n        const products = {};\n        querySnapshort.forEach(async (productDoc) => {\n          products[productDoc.id] = productDoc.data();\n          const priceSnap = await productDoc.ref.collection(\"prices\").get();\n          priceSnap.docs.forEach((price) => {\n            products[productDoc.id].prices = {\n              priceId: price.id,\n              priceData: price.data(),\n            };\n          });\n        });\n        setProducts(products);\n      });\n  }, []);\n\n  console.log(products);\n  if(subscription && subscription.role)\n  if(subscription && subscription.current_period_end)\n  \n  console.log(\"ads\",subscription, subscription.role);\n\n  const loadCheckout = async (priceId) => {\n    const docRef = await db\n      .collection(\"customers\")\n      .doc(user.uid)\n      .collection(\"checkout_sessions\")\n      .add({\n        price: priceId,\n        success_url: window.location.origin,\n        cancel_url: window.location.origin,\n      });\n\n    docRef.onSnapshot(async (snap) => {\n      const { error, sessionId } = snap.data();\n\n      if (error) {\n        alert(`An error occurred: ${error.message}`);\n      }\n\n      if (sessionId) {\n        const stripe = await loadStripe(\n          \"pk_test_51MVcA6SCUViwXHI98bsZZ6SAApob7bE88hnBKjXFNM4Xh510P0D4WMNYgEvdpfcO4vMivKZnkMokYeewDMzahKz500voXiuD0n\"\n        );\n\n        stripe.redirectToCheckout({ sessionId });\n      }\n    });\n  };\n\n  return (\n    <div className=\"planScreen\">\n      {subscription && (\n        <p>\n          Renewal date:{\" \"}\n          {new Date(subscription?.current_period_end * 1000).toLocaleDateString()}\n        </p>\n      )}\n      {Object.entries(products).map(([productsId, productData]) => {\n\n        let isCurrentPlan=null;\n  if(subscription && subscription.role)\n    isCurrentPlan = productData.name?.includes(subscription.role);\n        // console.log(\"saAS\", isCurrentPlan);\n        return (\n          <div\n            key={productsId}\n            className={`${isCurrentPlan && \"planScreen_plan--disabled\"} planScreen_plan`}\n          >\n            <div className=\"planScreen_info\">\n              <h5>{productData.name}</h5>\n              <h6>{productData.description}</h6>\n            </div>\n\n            <button\n              onClick={() =>\n                !isCurrentPlan && loadCheckout(productData.prices.priceId)\n              }\n            >\n              {isCurrentPlan ? \"Current Plan\" : \"Subscribe\"}\n            </button>\n          </div>\n        );\n      })}\n    </div>\n  \n  );\n\n  // return(\n  //   <div className=\"planScreen\">\n  //     {subscription && (\n  //       <p>\n  //         Renewal date:{\" \"}\n  //         {new Date(subscription?.current_period_end * 1000).toLocaleDateString}\n  //       </p>\n  //     )}\n  //     {Object.entries(products).map(([productId, productData]) => {\n  //       const isCurrentPackage = productData.name?.toLowerCase().includes(subscription?.role);\n\n  //       return(\n  //         <div key={productId} className={`${isCurrentPackage && \"planScreen_plan--disabled\"} planScreen_plan`}>\n  //           <div className=\"planScreen_info\">\n  //             <h5>{productData.name}</h5>\n  //             <h6>{productData.description}</h6>\n  //           </div>\n\n  //           <button onClick={() => !isCurrentPackage && loadCheckout(productData.prices.priceId)}>\n  //             {isCurrentPackage ? \"Current Package\" : \"Subscribe\"}\n  //           </button>\n  //         </div>\n  //       );\n  //     })}\n  //   </div>\n  // );\n}\n\n\nexport default PlanScreen;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}